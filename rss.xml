<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Raymond Luong]]></title><description><![CDATA[Software Engineer in San Francisco]]></description><link>https://www.raymondluong.com/</link><generator>RSS for Node</generator><lastBuildDate>Tue, 11 Feb 2020 06:49:44 GMT</lastBuildDate><item><title><![CDATA[TSConf Takeaways]]></title><description><![CDATA[Key takeaways, what Iâ€™m excited about going forward, and a comfy pair of socks.]]></description><link>https://www.raymondluong.com//blog/tsconf-takeaways/</link><guid isPermaLink="false">https://www.raymondluong.com//blog/tsconf-takeaways/</guid><pubDate>Mon, 04 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Last month, I had the privilege of flying to Seattle and attending &lt;a href=&quot;https://tsconf.io&quot; target=&quot;_blank&quot;&gt;TSConf&lt;/a&gt;, a one-day single-track conference all about TypeScript! I want to share some of my key takeaways and what Iâ€™m excited about going forward.&lt;/p&gt;
&lt;h2&gt;Start with the Problem&lt;/h2&gt;
&lt;p&gt;My first takeaway is from Lauren Tan, an engineer manager at Netflix. The main theme of her talk was the importance of starting with a problem and then finding the right technology to solve that problem. Sometimes, as engineers, weâ€™ll learn about a shiny new technology and try to find a way to use it on our team, yet run into issues convincing other folks to hop aboard because it doesnâ€™t have a real business impact or it solves a manufactured problem.&lt;/p&gt;
&lt;p&gt;For example, a problem with vanilla JavaScript can be the difficulty of reading the shape of data, especially for more complex objects, and the lost developer velocity from trying to understand that data. TypeScript can help solve that problem because types improve the readability of the code and add type safety, which in turn help catch bugs earlier and increase developer productivity. &lt;/p&gt;
&lt;h2&gt;Developer Experience&lt;/h2&gt;
&lt;p&gt;The TypeScript team is engaged with the community and invested in improving the developer experience. During the keynote, Anders Hejlsberg, one of the core developers on the TypeScript team at Microsoft, highlighted an example where a type error in a deeply nested object would output a nested pyramid of errors and obscure the source of the error. The TypeScript team responded to feedback from the community and flattened the pyramid of errors to be more readable.&lt;/p&gt;
&lt;p&gt;Another example is the improvements the TypeScript team made to the &lt;a href=&quot;http://www.typescriptlang.org/play/&quot; target=&quot;_blank&quot;&gt;TypeScript Playground&lt;/a&gt;, which makes it even easier to get started with trying TypeScript. Recent updates have added a formatter that supports JSX syntax, the ability o save code and settings to the URL to return later, and support for different versions of TypeScript, which in turn enables the ability to try out experimental features that are part of beta versions. Speaking ofâ€¦&lt;/p&gt;
&lt;h2&gt;Experimental Features&lt;/h2&gt;
&lt;p&gt;TypeScript has the ability try out experimental features that are being proposed for JavaScript. Two key examples (and two features that Iâ€™m personally very excited about) are &lt;a href=&quot;https://github.com/tc39/proposal-optional-chaining&quot; target=&quot;_blank&quot;&gt;optional chaining&lt;/a&gt; and &lt;a href=&quot;https://github.com/tc39/proposal-nullish-coalescing&quot; target=&quot;_blank&quot;&gt;nullish coalescing&lt;/a&gt;. At time of writing, theyâ€™re both TC39 stage 3 proposals, but they are incorporated in the beta version of TypeScript 3.7 and itâ€™s very likely that theyâ€™ll be released on TypeScript first.&lt;/p&gt;
&lt;h2&gt;Community Momentum&lt;/h2&gt;
&lt;p&gt;TypeScript has been gaining significant traction over the past few years. Based on the &lt;a href=&quot;https://2018.stateofjs.com/javascript-flavors/typescript/&quot; target=&quot;_blank&quot;&gt;State of JavaScript survey from 2018&lt;/a&gt;, the percentage of responders that have used TypeScript and would use it again has been steadily rising. Similarly, in the &lt;a href=&quot;https://octoverse.github.com/projects#languages&quot; target=&quot;_blank&quot;&gt;Github Octoverse analysis also from 2018&lt;/a&gt;, TypeScript made its way into the top 10 for the first time in 2017 and jumped up to seventh place in 2018. Additionally, in the same Github analysis, &lt;a href=&quot;https://github.com/DefinitelyTyped/DefinitelyTyped&quot; target=&quot;_blank&quot;&gt;DefinitelyTyped&lt;/a&gt;, the open-source repository of type definitions, is one of the top open source projects and had 6,000 unique contributors in 2018. I also recall one of the speakers at TSConf mention that DefinitelyTyped has more PRs created that can be feasibly reviewed by the maintainers (unfortunately I didnâ€™t manage to take a note of this at the time, so donâ€™t quote me on this ðŸ˜‰). Thereâ€™s a lot of energy and momentum around TypeScript right now and Iâ€™m excited for whatâ€™s in store.&lt;/p&gt;
&lt;h2&gt;Going forward&lt;/h2&gt;
&lt;p&gt;It was easy for me to get started with exploring TypeScript â€” I just had to open the playground and it was all there for me to try, including the new features that Iâ€™ve wanted in vanilla JavaScript for a while. Iâ€™m about to start a new project at work and Iâ€™m excited about building all of the React components with TypeScript because itâ€™ll provide type safety, help catch bugs, and improve code readability and developer productivity. &lt;/p&gt;
&lt;p&gt;Lastly, Iâ€™m looking forward to wearing these awesome TypeScript socks that were included in the goodie bag. My current company Gusto has a shoeless office â€” a perfect chance to show them off!&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/980c38478d8d4c3552737805cde399d9/b2ba1/typescript-socks.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 380px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 114.21052631578948%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGBUlEQVQ4yz2TWVCU2RmG/xlnJjOxUIe194XeoKHZm0VoZN9baEAbQYRBQFYFlKUFEUWjIeNAgSwK0mwDLmyK1kx0YqZykUyqMhepVJnczFQqS1WqktwkN7l7cmhTufjqr/rP+d7zvO/5jmQwGAg1GtDpDWi0euQKJXK5HIVCgUZv4mK/h6fPd1hd8+Isc/LRwYPIFHJfKVRKlBo1ulA95rBw4uzJSDqdDq1eJ36GotJoUO5v+l8p1DqqzjSw9/JL+oaGCJLJ8A/wJ0QuQ+5bV4keNXoBFWGLJrvAiaTRatBo3pZWpxWUWt/pcqUCmUqLy13NxtY2SUdTBd0PCQgK9An69vgIVT6YpNRjFJa6kUwmg4/mraDOd+K+FblKhX9gMPklZcx5F1GplRw6clj8C3hLKA7cL43oiYiOIy7JQUtHF9JQT6PITYFS4KsF7f5XoVQikwuBw0ewp6Qxc2+GiIhwDvr5ERQSTLAsBJlyv2ffrhFLZBTZheWsry8jbc9fxx4f7cvn/3T7F6NQ4XfoCNGx8fxk7AYFuek+wWDZW7v7ggrhwmKNJD41m/O9V3j15RbS07kBrra7fIv7dCofpcZH6Od3mMzMDK55OjlxPNtHFBIcINaEqFxBqMEk7NpJzytnaXWF1692kB5/2sL9K27sCXEiRzVqkYlCCKqUwrreSl3XNQbbKsjLcaA0x6CLzUBntBBmtRGTkk2m6zRT9x/wbPcRXzx/grTzaT3DzbkkHMvHYovBoFURHiZysZhROKpxt3oYqM8jOzcLlTURfWEHhZ2fUXJ5mcq+BdyPf8nGr75l3TvL3tOHSCvXTnLKlYUhu4b4jhksRU1EZFQQL4ZUG5mM01lE75kscjPsqPVmTHo1sZlOEgs/4URNF8U3d6m584yNlftsPvIiTXsqKGi7ijG9HOfgHPV3vyKxaULYsqI3ReBIT6W72kFGghmNMQxLcj6axDK01WPYBrY43jJB9vl57nlX2Nv9HOnHfTW4um+L7EIxWKOx57pIESFHxSUTeFxMwKlL9FYlUpAaQbDGiKpshNzRr8l5CsmL35Fdd5OAyW/o+Oo3vNwUhEPNBdhSMrCGWzCJ96gxmDELW2pTFAc6v6V4cJ3zrihK8lLRhcegTyggzX0JR+MYRac9qIafY/szLH3/V3bW7iG1VaWjVsox2x2o85qQJxQTlphJVGwSIaU3CM84SYszCmdJDkGhEYTpVWiiBUBSIY60IoLa1tEv/4Wrj1/xYmcNqcXtQC9mLyA8lYRLD6kc+4LI2lsYLTZssSkoonM5W5ZEZooNndmKMaWUoLRPCCy5Rnx5H2nFZ1FmdHCyd5YXu6tIl8XIWMLCCLfFElHaTkX/NKUXPkOmNYtXkkRouJ2KnBgSo0IJ0ITxg6YXRI//CfvCv1AW9WNPzkWfXEnTwBjPNheRrnQ4RdAeTCWdGI86CbKmYUjIITIpE3NiHrKjdbgK08myW1Aabfidmie5e4OivhVismpEVaPKaqVxZIbdx/NItztyOFrXz+HaeQLqvRw6Pc/B2kU+PLPMgQbxlFp/y4nKMrLSEzEec2PKb+XIsXb8y8b4uP0173u+Rxr9Dx3bb3iyOI402VvKaGsuKfUePj59H/+6B8LWLtK5V7zT9BKp/Xe4qmpwupx8UO3lnXOvkbrfIA3+XYzIP5BG/o3W+082d5+wvSFueWqoloUhFyPny4itv05Q7SyBDat80P4z3m3/hWj+jqLaTsqP5/CRe5Z3m3/KgXNf817vH5D6Bd3IHxl7uMfL7UUerQvB8aGzzFxvZry3nJudxZxobMJafwtFwwPe7/g5kudvtLU20FyTj597UhB/I+rXSJd+z3uDb7g4t8X22jRbDxfYWJpAmh/rZmm8j7ujrUyNNDI5cJLhznL6Witp7h2kbuQuN7qrGG7KIqPuIsE9rzF1PSLJs8HoxARby+NiXJZ5se1l7YEQXJm8zOrdYaZvdTF9u4e5O5eZH+th9kYrS3d62JjyMHXzAuOean50sZpbQ23cu32BpckrLE2PsipEnj1ZYG9zng3vOP8F9iqEjuXlVTIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;TypeScript socks&quot;
        title=&quot;&quot;
        src=&quot;/static/980c38478d8d4c3552737805cde399d9/b2ba1/typescript-socks.png&quot;
        srcset=&quot;/static/980c38478d8d4c3552737805cde399d9/0783d/typescript-socks.png 240w,
/static/980c38478d8d4c3552737805cde399d9/b2ba1/typescript-socks.png 380w&quot;
        sizes=&quot;(max-width: 380px) 100vw, 380px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Edit (11/5/19): A day after I published this, &lt;a href=&quot;https://twitter.com/typescript/status/1191766259035189249&quot; target=&quot;_blank&quot;&gt;TypeScript 3.7 launched&lt;/a&gt; out of beta! I like to think that my excitement had something to do with it ðŸ˜„&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Refactoring JavaScript with Codemods]]></title><description><![CDATA[Codemods are handy for automating large-scale changes. In this article, I'll share more about codemods, walk through a simple codemod that I wrote, and share some tips for debugging.]]></description><link>https://www.raymondluong.com//blog/refactoring-javascript-with-codemods/</link><guid isPermaLink="false">https://www.raymondluong.com//blog/refactoring-javascript-with-codemods/</guid><pubDate>Fri, 05 Jul 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;One of the most exciting parts about working with JavaScript is the fast-paced nature of the ecosystem. New patterns and standards evolve over time. However, keeping up with the changes can be complex and time-consuming because they may involve large-scale modifications or refactors that are a bit more involved than a simple find-and-replace. &lt;/p&gt;
&lt;p&gt;Fortunately, codemods are a handy tool that help us automate these changes. In this article, Iâ€™ll share more about codemods, walk through a simple codemod that I wrote, and share some tips for debugging.&lt;/p&gt;
&lt;h1&gt;What are codemods?&lt;/h1&gt;
&lt;p&gt;Codemods are scripts that automate a code change. Theyâ€™re usually comprised of two parts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Find all instances of the code to be changed, most easily accomplished with some form of pattern matching&lt;/li&gt;
&lt;li&gt;Apply a transformation to each instance, usually based on the original instance but with some modifications&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;When can I use codemods?&lt;/h1&gt;
&lt;p&gt;I mentioned large-scale refactors earlier â€” these can happen when upgrading versions of packages where existing methods are deprecated or new methods are introduced. They can also be used for syntax improvements or linting fixes.&lt;/p&gt;
&lt;p&gt;For example, in my current role at Gusto, weâ€™ve used codemods to fix ESLint errors (more on this below) and move off deprecated React features.&lt;/p&gt;
&lt;h1&gt;How do I write one?&lt;/h1&gt;
&lt;p&gt;To demonstrate how to write a codemod, Iâ€™ll walk through an example I wrote to fix an ESLint error. I assume a basic understanding of JavaScript, React, and tree data structures. Iâ€™ll also talk about &lt;a href=&quot;https://en.wikipedia.org/wiki/Abstract_syntax_tree&quot; target=&quot;_blank&quot;&gt;ASTs (Abstract Syntax Trees)&lt;/a&gt; but prior knowledge is not a required. &lt;/p&gt;
&lt;h2&gt;Context&lt;/h2&gt;
&lt;p&gt;At Gusto, we added ESLint to our codebase after we had already written a bunch of React components. However, some of our existing components did not match the ESLint rules that we decided to enforce. To avoid having those errors block us from adding ESLint, we suppressed the existing errors and added ESLint so it could immediately start having value for our new code going forward.&lt;/p&gt;
&lt;p&gt;One of the errors we suppressed is &lt;code class=&quot;language-text&quot;&gt;react/destructuring-assignment&lt;/code&gt;, which prefers using &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment&quot; target=&quot;_blank&quot;&gt;ES6 destructuring syntax&lt;/a&gt; when possible. For example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; mailingAddress&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; address &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;is preferred to&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mailingAddress&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are a bunch of components in our codebase that do not destructure and have the destructuring-assignment rule suppressed. Iâ€™ll walk through a codemod I wrote to address the specific case above. Note that this is just one example and it doesnâ€™t cover &lt;em&gt;all&lt;/em&gt; the violations of the destructuring-assignment rule. When writing codemods, Iâ€™ve found that itâ€™s simplest to start with the basic cases and gradually add on more complex cases.&lt;/p&gt;
&lt;h2&gt;Step 0: Boilerplate code&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://github.com/facebook/jscodeshift&quot; target=&quot;_blank&quot;&gt;jscodeshift&lt;/a&gt; package allows us to write codemods for JavaScript. To get started, we can use the following boilerplate code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;file&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jscodeshift&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Step 1: Find all instances of the code to change&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; instances &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;â€¦&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Step 2: Apply a code transformation and replace the code&lt;/span&gt;
  instances&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replaceWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;â€¦&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Step 1: Find all instances of the code to change&lt;/h2&gt;
&lt;p&gt;To accomplish step 1, weâ€™ll use pattern matching with AST (abstract syntax tree). AST allows us to represent code as a tree where each syntactic pattern is represented as a node, perhaps as a subtree of other nodes or with its own children nodes. There is a handy website called &lt;a href=&quot;https://astexplorer.net/&quot; target=&quot;_blank&quot;&gt;AST Explorer&lt;/a&gt; that we can use to visualize code as an AST.&lt;/p&gt;
&lt;p&gt;Letâ€™s see what the AST structure looks like for our example code snippet:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6c8b0f302ebe55279374380804a79a66/032d8/step1-ast.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 59.70287836583101%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABQElEQVQoz52Sa2rDMBCEc/97tYEeIMTkZUmWLevtlORHa3m6UhKapBTqGoZdtPBptOPF+f2M45BwOiWcjycMw4AYY6kfnyNelm94XS5RbQ6oa4aat+CsBuMSh1qUfs9aMMaKFmMa8duX0oQYArq2wY5zbLmA6DSMybLQ2sBoTTX3GtZaApKLaQJp+qGUEgIBvfdoO4kNAStp0REsn8UYyjxfGq5ajOPF4Q1y6y8Ov4ExDnA9I4ccQvcYroA8u9ffgFnOQbV7bIXESlgcOgtDZ/fQWQ5DiLBaQvIV1kJj3RhoenoIGRbmA324QtUeUnFIY8ruLiA/f4e5OkvpKgaVU3b+Yfa/JxOsbSqspcKuU3DePcBmO7Smg1Y1JKWsSyD+IZAZwJx0hCegMarA4lO6M4AEchZ931AQtvxCz7u7h34BVjWX8ohXw+MAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;AST part 1&quot;
        title=&quot;&quot;
        src=&quot;/static/6c8b0f302ebe55279374380804a79a66/f570d/step1-ast.png&quot;
        srcset=&quot;/static/6c8b0f302ebe55279374380804a79a66/0783d/step1-ast.png 240w,
/static/6c8b0f302ebe55279374380804a79a66/782f4/step1-ast.png 480w,
/static/6c8b0f302ebe55279374380804a79a66/f570d/step1-ast.png 960w,
/static/6c8b0f302ebe55279374380804a79a66/8d0ff/step1-ast.png 1440w,
/static/6c8b0f302ebe55279374380804a79a66/a987b/step1-ast.png 1920w,
/static/6c8b0f302ebe55279374380804a79a66/032d8/step1-ast.png 2154w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;The overall expression is a &lt;code class=&quot;language-text&quot;&gt;VariableDeclaration&lt;/code&gt; that has a &lt;code class=&quot;language-text&quot;&gt;kind&lt;/code&gt; of &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;, since we declared the variable with &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;, and a single &lt;code class=&quot;language-text&quot;&gt;VariableDeclarator&lt;/code&gt; for everything after the &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt; keyword.&lt;/p&gt;
&lt;p&gt;This &lt;code class=&quot;language-text&quot;&gt;VariableDeclarator&lt;/code&gt; in turn has two children. The first is the &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt; or how the variable is named, in this case itâ€™s an &lt;code class=&quot;language-text&quot;&gt;Identifier&lt;/code&gt; thatâ€™s named &lt;code class=&quot;language-text&quot;&gt;address&lt;/code&gt;. The second is the &lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt; or how the variable is initialized, in this case itâ€™s a &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; for &lt;code class=&quot;language-text&quot;&gt;this.props.mailingAddress&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Breaking down the &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; further, we can see that itâ€™s comprised of a second &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; to capture &lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt; and an &lt;code class=&quot;language-text&quot;&gt;Identifier&lt;/code&gt; to capture &lt;code class=&quot;language-text&quot;&gt;mailingAddress&lt;/code&gt;. The inner &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; containing &lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt; can be broken down even further into a &lt;code class=&quot;language-text&quot;&gt;ThisExpression&lt;/code&gt; for the &lt;code class=&quot;language-text&quot;&gt;this&lt;/code&gt; keyword and an &lt;code class=&quot;language-text&quot;&gt;Identifier&lt;/code&gt; property with the name &lt;code class=&quot;language-text&quot;&gt;props&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If this is hard to see, you can open the &lt;a href=&quot;https://astexplorer.net/&quot; target=&quot;_blank&quot;&gt;AST Explorer&lt;/a&gt; and hover over different parts of the input code, which will highlight the corresponding AST nodes on the right side.&lt;/p&gt;
&lt;p&gt;We can use the &lt;code class=&quot;language-text&quot;&gt;find&lt;/code&gt; method from jscodeshift and pass in a pattern based on what we see in the AST explorer. Hereâ€™s what that looks like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; instances &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VariableDeclarator&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Identifier&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  init&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    object&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;MemberExpression&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      object&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ThisExpression&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      property&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;props&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    property&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Identifier&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point, itâ€™s good to sanity check that our search works as expected. To do so, I like to test the codemod on one file. Letâ€™s say we have the following example component that does a bunch of things, including displaying an address from the props:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// other interesting behavior&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; address &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mailingAddress&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// other components&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;AddressDisplay address&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;address&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// other components&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can run our codemod and add some &lt;code class=&quot;language-text&quot;&gt;console.log&lt;/code&gt; statements to ensure that itâ€™s finding the correct lines.&lt;/p&gt;
&lt;p&gt;To run the codemod, youâ€™ll need the jscodeshift CLI:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;jscodeshift -t ~/path/to/codemod.js ~/path/to/component.jsx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;-t specifies to transform the code.&lt;/p&gt;
&lt;p&gt;Adding logging:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instances&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// outputs 1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Not convinced? We can dig into the instance and log some of the properties, for example the name:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instances&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// outputs address&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Great! Looks like itâ€™s finding what weâ€™re expecting. Letâ€™s move on to step 2.&lt;/p&gt;
&lt;h2&gt;Step 2: Apply a transformation and replace the code&lt;/h2&gt;
&lt;p&gt;To figure out how to represent our target code, weâ€™ll go back to the AST explorer. This time, our input will be our desired code.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6a559e5463d4442b3b5a6cfb3bbff92d/e0a38/step2-ast.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 62.44503078276165%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVQoz6WS/U7CMBTFef+3Ut+AhBAjc+3Kunb9GoSNicmOt9UKU/4QbHJyuyznl9N77+J0PKE/9DiQ9ntgt5/wNr5jHEYUTODh8QnL1TM2RQEmJKqKg4sarKpRcU5VglOVUsIYgwVmZ5p9DccR3gcCbbHaFFhzDanaZGyNnVVrLUIIWEzThLPwfY+n73s457DrAlpd44WVqFQ0dujIHAG5RnnvP4Ep23ROl+/DMCSg/zJEqKg5XhsFR+YMyUoJceX8BIbgUyrvWmjFwJWCpGf6C2hO+UdgSEBnGsi6wEY2YATN/+4EBjiroIyC9bGv3S/YzU82qoQQazCtZ727K2Fcn9hDb2qYnDqBbk0YTSTbSghamVIFNK27OpAbEnaweostX2LJJcrG/BdIA3GWoBUNRc928BIW9QHMAJgnBYZ4UAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;AST part 2&quot;
        title=&quot;&quot;
        src=&quot;/static/6a559e5463d4442b3b5a6cfb3bbff92d/f570d/step2-ast.png&quot;
        srcset=&quot;/static/6a559e5463d4442b3b5a6cfb3bbff92d/0783d/step2-ast.png 240w,
/static/6a559e5463d4442b3b5a6cfb3bbff92d/782f4/step2-ast.png 480w,
/static/6a559e5463d4442b3b5a6cfb3bbff92d/f570d/step2-ast.png 960w,
/static/6a559e5463d4442b3b5a6cfb3bbff92d/8d0ff/step2-ast.png 1440w,
/static/6a559e5463d4442b3b5a6cfb3bbff92d/a987b/step2-ast.png 1920w,
/static/6a559e5463d4442b3b5a6cfb3bbff92d/e0a38/step2-ast.png 2274w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Again, our main output is a &lt;code class=&quot;language-text&quot;&gt;VariableDeclaration&lt;/code&gt; of &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt; kind with a &lt;code class=&quot;language-text&quot;&gt;VariableDeclarator&lt;/code&gt;, but the &lt;code class=&quot;language-text&quot;&gt;VariableDeclarator&lt;/code&gt; subtree is different. For the &lt;code class=&quot;language-text&quot;&gt;id&lt;/code&gt;, instead of the name of the variable, we have an &lt;code class=&quot;language-text&quot;&gt;ObjectPattern&lt;/code&gt; to represent a JavaScript Object. The properties of the object are an array for each key/value pair. For our example, there is a single &lt;code class=&quot;language-text&quot;&gt;Property&lt;/code&gt; with a key of &lt;code class=&quot;language-text&quot;&gt;address&lt;/code&gt; and a value of &lt;code class=&quot;language-text&quot;&gt;mailingAddress&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;For the &lt;code class=&quot;language-text&quot;&gt;init&lt;/code&gt;, we have a &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; that matches the inner &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; from the first step, which makes sense because the expression to the right of the equals sign in our target code is simply &lt;code class=&quot;language-text&quot;&gt;this.props&lt;/code&gt;. &lt;/p&gt;
&lt;p&gt;Now letâ€™s translate this into our replace method. We can learn what the inputs are for each type by looking at the type definitions in the &lt;a href=&quot;https://github.com/benjamn/ast-types/blob/master/def&quot; target=&quot;_blank&quot;&gt;ast-types library&lt;/a&gt;. The fields for each type correspond to its arguments.&lt;/p&gt;
&lt;p&gt;Our &lt;code class=&quot;language-text&quot;&gt;ObjectPattern&lt;/code&gt; has one &lt;code class=&quot;language-text&quot;&gt;Property&lt;/code&gt; for the one key/valule pair. We can pull the names from the instance:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; variableName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;property&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we can use these as inputs into our &lt;code class=&quot;language-text&quot;&gt;ObjectPattern&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;objectPattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;variableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next weâ€™ll build the &lt;code class=&quot;language-text&quot;&gt;MemberExpression&lt;/code&gt; by looking at the type and seeing what the inputs are. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;memberExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;thisExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;props&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Combining these, we get our replace step:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;instances&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; variableName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;property&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replaceWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;variableDeclarator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;objectPattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;variableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;memberExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;thisExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;props&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Letâ€™s run our codemod on our test component again and see what happens:&lt;/p&gt;
&lt;p&gt;Output:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleComponent&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;React&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Component&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// other interesting behavior&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      address&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mailingAddress
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// other components&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;AddressDisplay address&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;address&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// other components&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Itâ€™s &lt;em&gt;almost&lt;/em&gt; what we expect, but there are line breaks inside the object. Upon digging into the &lt;a href=&quot;https://github.com/benjamn/recast/blob/52a7ec3eaaa37e78436841ed8afc948033a86252/lib/printer.js#L575&quot; target=&quot;_blank&quot;&gt;recast library&lt;/a&gt; that jscodeshift uses to print, it looks like line breaks are built in to how &lt;code class=&quot;language-text&quot;&gt;ObjectPattern&lt;/code&gt; is printed.&lt;/p&gt;
&lt;p&gt;Additionally, if we have a case where the variable name and prop name are the same, ESLint will complain further that we can use the object shorthand syntax:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; address&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; address &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Angry ESLint&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; address &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// Happy ESLint&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Fortunately, both of these issues can be fixed with ESLintâ€™s fix option. The shorthand error can also be addressed by extending our codemod â€” the &lt;code class=&quot;language-text&quot;&gt;ObjectPattern&lt;/code&gt; type accepts a shorthand parameter that applies if the variable name and prop name are the same. However, since weâ€™ll be using the ESLint auto-fix feature anyway, Iâ€™d prefer to just let ESLint fix it for us.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;eslint --fix ~/path/to/component.jsx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There you go! Itâ€™s definitely a process that involves a lot of trial and error, console logging, and back and forth between the code and the AST explorer, but it can end up being more efficient and saving more time than manually applying a transformation.&lt;/p&gt;
&lt;h2&gt;Debugging tips&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;console.log&lt;/code&gt; is your friend! I havenâ€™t found a way to get a debugger (if you know a way, please let me know!), so Iâ€™ve been relying heavily on logging at every step to verify the behavior. Logging &lt;code class=&quot;language-text&quot;&gt;Object.keys&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Object.entries&lt;/code&gt; has been especially useful in seeing all the available properties.&lt;/li&gt;
&lt;li&gt;Use the AST explorer! Writing codemods would be almost impossible without some way of visualizing code as an AST.&lt;/li&gt;
&lt;li&gt;When youâ€™re at the replace step, ensure that youâ€™re passing in the correct arguments to the node types that youâ€™re building. You can look at the type definitions in the &lt;code class=&quot;language-text&quot;&gt;ast-types&lt;/code&gt; repo for all the type annotations.&lt;/li&gt;
&lt;li&gt;Make sure you are using the correct parser setting. We use Flow in our JavaScript so I include &lt;code class=&quot;language-text&quot;&gt;parser=flow&lt;/code&gt; in all my &lt;code class=&quot;language-text&quot;&gt;jscodeshift&lt;/code&gt; commands.&lt;/li&gt;
&lt;li&gt;Look at existing codemods, there are some great examples in the &lt;a href=&quot;https://github.com/reactjs/react-codemod&quot; target=&quot;_blank&quot;&gt;react-codemod&lt;/a&gt; library. If youâ€™re looking to apply a transformation, check online to see if someone has already written something similar. &lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Reference&lt;/h1&gt;
&lt;p&gt;All of the links from inside the article:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Abstract_syntax_tree&quot; target=&quot;_blank&quot;&gt;ASTs (Abstract Syntax Trees)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment&quot; target=&quot;_blank&quot;&gt;ES6 destructuring syntax&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/facebook/jscodeshift&quot; target=&quot;_blank&quot;&gt;jscodeshift&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://astexplorer.net/&quot; target=&quot;_blank&quot;&gt;AST Explorer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/benjamn/ast-types/tree/master/def&quot; target=&quot;_blank&quot;&gt;AST type definitions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/reactjs/react-codemod&quot; target=&quot;_blank&quot;&gt;react-codemod&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Lastly, hereâ€™s the codemod in its entirety:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;exports&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;file&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; api&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;jscodeshift&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;source&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Step 1: Find all instances of the code to change&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; instances &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VariableDeclarator&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Identifier&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    init&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      object&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;MemberExpression&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        object&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ThisExpression&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        property&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;props&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      property&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Identifier&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Step 2: Apply a code transformation and replace the code&lt;/span&gt;
  instances&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;instance&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; variableName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; propName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;property&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;replaceWith&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;variableDeclarator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;objectPattern&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;property&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;init&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;propName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;variableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;memberExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;thisExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;props&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Celebrating Pride with CSS]]></title><description><![CDATA[Let's make a rainbow!]]></description><link>https://www.raymondluong.com//blog/celebrating-pride-with-css/</link><guid isPermaLink="false">https://www.raymondluong.com//blog/celebrating-pride-with-css/</guid><pubDate>Thu, 23 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;With Pride month approaching, I want to see if I can add some pizzazz to Hippo, one of the  products I work on at Gusto. Our operations teams use Hippo internally to manage the benefits information for our customers. Each customer has a corresponding display page and next to the customerâ€™s name, we display list of labels for each state that the customer operates in. My goal is to turn these drab state labels into a colorful rainbow.&lt;/p&gt;
&lt;p&gt;Hereâ€™s what it currently looks like.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6149505fd1a68703c96daa3a8d1b0790/de00b/state-labels-gray.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 10.144927536231883%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAbElEQVQI1z2N4Q6EIAyDff+XMshgQ5zG8yC8TR1L7n40Tbvs63JdihgD9l1QCiNnQq0FIhkpRe9UK8Zodtssp7+Yyf6yuwihtQ+W57kRwurQH2QCJoho8zzHxujmjOMoLtViw4zzrObi6v2LF1wZhk86sjRZAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;State labels&quot;
        title=&quot;&quot;
        src=&quot;/static/6149505fd1a68703c96daa3a8d1b0790/f570d/state-labels-gray.png&quot;
        srcset=&quot;/static/6149505fd1a68703c96daa3a8d1b0790/0783d/state-labels-gray.png 240w,
/static/6149505fd1a68703c96daa3a8d1b0790/782f4/state-labels-gray.png 480w,
/static/6149505fd1a68703c96daa3a8d1b0790/f570d/state-labels-gray.png 960w,
/static/6149505fd1a68703c96daa3a8d1b0790/de00b/state-labels-gray.png 1104w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;My first thought is to add CSS helper classes for the different colors and use Ruby to determine when to apply each class. We currently use a Rails view with embedded ruby for the state labels. Hereâ€™s a code snippet:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;erb&quot;&gt;&lt;pre class=&quot;language-erb&quot;&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt; states&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;state&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;label state&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt; state &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We have our &lt;code class=&quot;language-text&quot;&gt;states&lt;/code&gt; variable which is an array of state abbreviations, e.g. &lt;code class=&quot;language-text&quot;&gt;[&amp;#39;CA&amp;#39;, &amp;#39;NJ&amp;#39;, &amp;#39;NY&amp;#39;]&lt;/code&gt;. We loop through each state to display a span element with the label and state classes and the state name inside the element.&lt;/p&gt;
&lt;p&gt;Letâ€™s say we have the following CSS helper classes. Note that Iâ€™m using SASS variables (denoted by the &lt;code class=&quot;language-text&quot;&gt;$&lt;/code&gt;) for readability, but any color value or hex code will work.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.red&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $red &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.orange&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $orange &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.yellow&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $yellow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.green&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $green &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.blue&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $blue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.indigo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $indigo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token selector&quot;&gt;;
.violet&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $violet &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ruby has a method called &lt;code class=&quot;language-text&quot;&gt;each_with_index&lt;/code&gt; that gives us the index of the element as the second parameter of the block. It looks like we can use the index to determine the class. For example, an index of 1 would be red, an index of 2 would be orange, and so on.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;erb&quot;&gt;&lt;pre class=&quot;language-erb&quot;&gt;&lt;code class=&quot;language-erb&quot;&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt; states&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;each_with_index &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;state&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; index&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;
  # Nest ternary for each color
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;span&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;label state &lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;index &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;red&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;...&apos;&lt;/span&gt; &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%=&lt;/span&gt; state &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;span&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token erb language-erb&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;&amp;lt;%&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;token delimiter punctuation&quot;&gt;%&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Functionally this would work, but nesting that many ternaries makes the code incredibly hard to read and it feels like we are stuffing too much logic into the view. Fortunately, we can accomplish this rainbow &lt;strong&gt;entirely with CSS&lt;/strong&gt;. CSS3 added the &lt;code class=&quot;language-text&quot;&gt;nth-child&lt;/code&gt; selector that allows targeting DOM elements based on their position, e.g. the first child. We can chain the &lt;code class=&quot;language-text&quot;&gt;nth-child&lt;/code&gt; selector onto the &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; class that we declare in our view.&lt;/p&gt;
&lt;p&gt;Letâ€™s try this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(1n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $red &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(2n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $orange &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(3n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $yellow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(4n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $green &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(5n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $blue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(6n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $indigo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $violet &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After refreshing the page, we get this:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b0a3b5e02e7493af0af29dd0d345daf5/f33be/state-labels-rainbow-7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 9.532374100719423%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAkUlEQVQI1z3MOw6CQABFUfe/AWOjFQWGmGBU/KAMDDDDiFqpQFC00cLELVyVwurdvOJ0hNigdUqaxkgZolTy7yxT7VbFiatrc1/ZPI3Fu+rhbvsM1ZzBLKTrLJDjM/WxoRMEa5JEtlAcR+S5wRjdor8vigTlF2z8KbdowmPv8qptlgcHbxcyEhrLExi/5FI0fACd4oQGfG/2qwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;State labels&quot;
        title=&quot;&quot;
        src=&quot;/static/b0a3b5e02e7493af0af29dd0d345daf5/f570d/state-labels-rainbow-7.png&quot;
        srcset=&quot;/static/b0a3b5e02e7493af0af29dd0d345daf5/0783d/state-labels-rainbow-7.png 240w,
/static/b0a3b5e02e7493af0af29dd0d345daf5/782f4/state-labels-rainbow-7.png 480w,
/static/b0a3b5e02e7493af0af29dd0d345daf5/f570d/state-labels-rainbow-7.png 960w,
/static/b0a3b5e02e7493af0af29dd0d345daf5/f33be/state-labels-rainbow-7.png 1112w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;It looks like the seven state labels are a rainbow. Great, that was straightforward!&lt;/p&gt;
&lt;p&gt;To sanity check, letâ€™s test on a company with more than 7 states.&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8494681b7d70e87a5e38a4d91d1fe934/09e83/state-labels-off-rainbow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 7.526881720430108%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjUlEQVQI1xXMzRJCUABAYe//GG0aG6opxPVbfsIVCtPUjLHlIU4szu7Mp0hZsJVlCVVV8u5ejJFgCo4sncbvs0cvTzilZGf6xF6/vjV2o7J8VYwspnev2JbANQyUDdnANLlT5BlNWzMmIVNsMQ/nFdS4VCa+fKKKG2k4kOcNXntg/uk4xYMhdPHcgEgI/icEhQr8PDGGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;State labels&quot;
        title=&quot;&quot;
        src=&quot;/static/8494681b7d70e87a5e38a4d91d1fe934/f570d/state-labels-off-rainbow.png&quot;
        srcset=&quot;/static/8494681b7d70e87a5e38a4d91d1fe934/0783d/state-labels-off-rainbow.png 240w,
/static/8494681b7d70e87a5e38a4d91d1fe934/782f4/state-labels-off-rainbow.png 480w,
/static/8494681b7d70e87a5e38a4d91d1fe934/f570d/state-labels-off-rainbow.png 960w,
/static/8494681b7d70e87a5e38a4d91d1fe934/8d0ff/state-labels-off-rainbow.png 1440w,
/static/8494681b7d70e87a5e38a4d91d1fe934/09e83/state-labels-off-rainbow.png 1674w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Hmmm, not quite right. It starts off as a rainbow but quickly diverges.&lt;/p&gt;
&lt;p&gt;Iâ€™ll pause here and give you a chance to see if you can spot the bug in my code.&lt;/p&gt;
&lt;p&gt;â€”&lt;/p&gt;
&lt;p&gt;Spot the issue? Itâ€™s ok if you donâ€™t, it took me a while. Letâ€™s step through it:&lt;/p&gt;
&lt;p&gt;The colors rendered are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Red&lt;/li&gt;
&lt;li&gt;Orange&lt;/li&gt;
&lt;li&gt;Yellow&lt;/li&gt;
&lt;li&gt;Green&lt;/li&gt;
&lt;li&gt;Blue&lt;/li&gt;
&lt;li&gt;Indigo&lt;/li&gt;
&lt;li&gt;Violet&lt;/li&gt;
&lt;li&gt;Green&lt;/li&gt;
&lt;li&gt;Yellow&lt;/li&gt;
&lt;li&gt;Blue&lt;/li&gt;
&lt;li&gt;Red&lt;/li&gt;
&lt;li&gt;Indigo&lt;/li&gt;
&lt;li&gt;Red&lt;/li&gt;
&lt;li&gt;Violet&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;When using &lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt; in a pattern passed into &lt;code class=&quot;language-text&quot;&gt;nth-child&lt;/code&gt;, the style applies to every element whose position matches that pattern for every positive integer or zero value. For example, looking at &lt;code class=&quot;language-text&quot;&gt;3n&lt;/code&gt;, passing in every positive integer or zero as &lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt; gives us 0, 3, 6, 9, 12, effectively every third element. &lt;/p&gt;
&lt;p&gt;How are the colors for this 14-state list determined? The first seven work as expected. The eighth element, the &lt;code class=&quot;language-text&quot;&gt;1n&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;2n&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;4n&lt;/code&gt; rules apply to it, but the &lt;code class=&quot;language-text&quot;&gt;4n&lt;/code&gt; rule is declared later in the CSS file so it wins the CSS specificity test. The ninth element, the &lt;code class=&quot;language-text&quot;&gt;1n&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;3n&lt;/code&gt; rules apply to it but the &lt;code class=&quot;language-text&quot;&gt;3n&lt;/code&gt; rule wins the specificity test. The remaining elements also follow a similar pattern. Note that &lt;code class=&quot;language-text&quot;&gt;1n&lt;/code&gt; effectively becomes the fallback style for every element.&lt;/p&gt;
&lt;p&gt;Letâ€™s try this again, this time &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/CSS/:nth-child&quot; target=&quot;_blank&quot;&gt;reading the documentation&lt;/a&gt; carefully. The &lt;code class=&quot;language-text&quot;&gt;nth-child&lt;/code&gt; selector accepts an expression of &lt;code class=&quot;language-text&quot;&gt;An + B&lt;/code&gt; where &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; is the length of the repeating pattern and &lt;code class=&quot;language-text&quot;&gt;B&lt;/code&gt; is a shift in the pattern. For our rainbow, we have a repeating pattern of seven colors, so &lt;code class=&quot;language-text&quot;&gt;A&lt;/code&gt; is 7. DOM elements are 1-indexed so &lt;code class=&quot;language-text&quot;&gt;B&lt;/code&gt; is 1 for the first color, 2 for the second color, and so on. Putting this all together, we get:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+1)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $red &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+2)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $orange &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+3)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $yellow &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+4)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $green &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+5)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $blue &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+6)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $indigo &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;.state:nth-child(7n+7)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;background-color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $violet &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And the final result:&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f027d530e8e329fdf069c0a008674296/c23a1/state-labels-final-rainbow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 6.900726392251816%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAV0lEQVQI1x3FwQpAMBwHYO//EA5yGCWXpaHon202FHPYQUk57iV+tMPXl1g7Q2sZGaPj6nfuG56eI6wFvE9RLy3yjtAIh0sQ3rFC8BmGg4GRRMkV3HTjA27AQcjSHz0rAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;&quot;
        alt=&quot;State labels&quot;
        title=&quot;&quot;
        src=&quot;/static/f027d530e8e329fdf069c0a008674296/f570d/state-labels-final-rainbow.png&quot;
        srcset=&quot;/static/f027d530e8e329fdf069c0a008674296/0783d/state-labels-final-rainbow.png 240w,
/static/f027d530e8e329fdf069c0a008674296/782f4/state-labels-final-rainbow.png 480w,
/static/f027d530e8e329fdf069c0a008674296/f570d/state-labels-final-rainbow.png 960w,
/static/f027d530e8e329fdf069c0a008674296/8d0ff/state-labels-final-rainbow.png 1440w,
/static/f027d530e8e329fdf069c0a008674296/c23a1/state-labels-final-rainbow.png 1652w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Happy Pride!&lt;/p&gt;</content:encoded></item></channel></rss>